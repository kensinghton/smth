ENV["LC_ALL"] = "en_US.UTF-8"

$script = <<-EOF1
export LC_ALL=en_US.UTF-8
sudo setsebool -P httpd_can_network_connect true && echo SELinux command OK
sudo wget -O /etc/yum.repos.d/nginx.repo https://raw.githubusercontent.com/zulus911/lectures/master/lecture2/nginx.repo
sudo yum -y install nginx 
cat >/etc/nginx/conf.d/default.conf <<CNG
server { 
  server_name 192.168.1.241;

  # app1 reverse proxy follow
  proxy_set_header X-Real-IP $remote_addr;
  proxy_set_header Host $host;
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_pass http://192.168.1.241:80;

}

server { 
  server_name 192.168.1.242;

  # app2 reverse proxy settings follow
  proxy_set_header X-Real-IP $remote_addr;
  proxy_set_header Host $host;
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_pass http://192.168.1.242:80;
}
CNG
sudo service jenkins start
sudo service nginx start
EOF1

$script1 = <<-EOF2
export LC_ALL=en_US.UTF-8

EOF2

Vagrant.configure("2") do |config|
  config.vm.define "test-vagrant" do |public1|
    public1.vm.box = "generic/centos7"
    public1.vm.hostname = "pub1.box"
    public1.vm.network :public_network,  bridge: "enp1s0", use_dhcp_assigned_default_route: true, ip: "192.168.1.240"
    public1.vm.provision "shell", inline: $script
end  
config.vm.define "test-vagrant" do |reverse1|
    reverse1.vm.box = "generic/centos7"
    reverse1.vm.hostname = "rev1.box"
    reverse1.vm.network :public_network,  bridge: "enp1s0", use_dhcp_assigned_default_route: true, ip: "192.168.1.241"
    reverse1.vm.provision "shell", inline: $script1
end  
config.vm.define "test-vagrant" do |reverse2|
    reverse2.vm.box = "generic/centos7"
    reverse2.vm.hostname = "rev2.box"
    reverse2.vm.network :public_network,  bridge: "enp1s0", use_dhcp_assigned_default_route: true, ip: "192.168.1.242"
    reverse2.vm.provision "shell", inline: $script1
end  
end
