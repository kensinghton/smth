ENV["LC_ALL"] = "en_US.UTF-8"

ip1 = 'vagrant ssh -c "rev1.box -I | cut -d' ' -f2" 2>/dev/null'
ip2 = 'vagrant ssh -c "rev2.box -I | cut -d' ' -f2" 2>/dev/null'

$script = <<-EOF1
export LC_ALL=en_US.UTF-8
sudo yum -y install wget
sudo setsebool -P httpd_can_network_connect true && echo SELinux command OK
sudo wget -O /etc/yum.repos.d/nginx.repo https://raw.githubusercontent.com/zulus911/lectures/master/lecture2/nginx.repo
sudo yum -y install nginx 
cat >/etc/nginx/conf.d/default.conf <<CNG
upstream backend {
    server ip1;
    server ip2;
}
server {
    location / {
        proxy_pass http://backend;
    }
}
CNG

sudo service nginx start
EOF1



$script1 = <<-EOF2
export LC_ALL=en_US.UTF-8

sudo setsebool -P httpd_can_network_connect true && echo SELinux command OK
sudo yum -y install wget
sudo wget -O /etc/yum.repos.d/jenkins.repo http://pkg.jenkins-ci.org/redhat-stable/jenkins.repo
sudo rpm --import https://jenkins-ci.org/redhat/jenkins-ci.org.key
sudo yum -y install jenkins nginx net-tools policycoreutils-python java
sudo wget -O /etc/sysconfig/jenkins https://raw.githubusercontent.com/zulus911/lectures/master/lecture2/jenkins
EOF2


Vagrant.configure("2") do |config|
  config.vm.define "test-vagrant" do |public1|
    public1.vm.box = "generic/centos7"
    public1.vm.hostname = "pub1.box"
    public1.vm.network :public_network,  bridge: "enp1s0", use_dhcp_assigned_default_route: true
    public1.vm.provision "shell", inline: $script
end  
config.vm.define "test-vagrant" do |reverse1|
    reverse1.vm.box = "generic/centos7"
    reverse1.vm.hostname = "rev1.box"
    reverse1.vm.network "private_network", type: "dhcp"
    reverse1.vm.provision "shell", inline: $script1
    #reverse1.vm.provider "virtualbox" do |vb|
    #    vb.linked_clone = true
    #end 
end  
config.vm.define "test-vagrant" do |reverse2|
    reverse2.vm.box = "generic/centos7"
    reverse2.vm.hostname = "rev2.box"
    reverse2.vm.network "private_network", type: "dhcp"
    reverse2.vm.provision "shell", inline: $script1
    #reverse2.vm.provider "virtualbox" do |vb|
    #    vb.linked_clone = true
    #end 
end

 
end

